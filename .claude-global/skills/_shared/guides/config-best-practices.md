# Claude Code 設定ベストプラクティス

## Skills

### 設計原則

1. **簡潔さ**: SKILL.md本文は500行以下
2. **Progressive Disclosure**: 詳細は`references/`に分離
3. **具体例 > 説明**: Claudeは賢いので冗長な説明は不要
4. **明確なトリガー**: `description`にキーワードを含める

### frontmatter詳細

| フィールド | 必須 | 説明 | 制約 |
|-----------|------|------|------|
| name | Yes | スキル識別子 | ハイフンケース、64文字以内 |
| description | Yes | 説明とトリガー | 1024文字以内 |
| allowed-tools | No | ツール制限 | カンマ区切り |
| model | No | モデル指定 | claude-sonnet-4等 |
| context | No | 実行コンテキスト | fork でサブエージェント |
| user-invocable | No | /メニュー表示 | true/false |

### description設計

```yaml
# 悪い例
description: ドキュメントを処理する

# 良い例
description: PDFからテキスト・表を抽出、フォーム入力、文書結合。「PDF操作」「フォーム記入」「文書抽出」と依頼された時に使用。
```

### ディレクトリ構成

```
skill-name/
├── SKILL.md           # 必須: 手順・ガイドライン
├── references/        # 参照ドキュメント（必要時のみ読み込み）
├── scripts/           # 実行スクリプト（読み込まず実行）
└── assets/            # テンプレート・画像等
```

---

## Commands

### 設計原則

1. **最小権限**: `allowed-tools`で必要なツールのみ許可
2. **動的コンテキスト**: `!` プレフィックスでシェル出力を注入
3. **名前空間**: サブディレクトリで整理

### Skills vs Commands

| 観点 | Skill | Command |
|------|-------|---------|
| 用途 | 対話・相談 | アクション実行 |
| 呼び出し | Claude自動選択 or 明示 | /コマンド名 |
| 例 | code-review, debug | commit, deploy |

---

## Agents

### 設定方法

**保存場所**: `.claude/agents/` または `.claude-global/agents/`

```markdown
---
name: security-reviewer
description: セキュリティ専門のコードレビュアー
tools:
  - Read
  - Grep
  - Glob
allowedCommands:
  - npm audit
  - git log
---

# Security Reviewer

あなたはセキュリティ専門のコードレビュアーです。

## 原則
- 攻撃者の視点で脆弱性を探す
- OWASP Top 10 を常に意識
- 認証・認可の境界を厳密にチェック

## 出力形式
...
```

### プロンプト設計ベストプラクティス

| 要素 | 内容 |
|------|------|
| ロール定義 | 「あなたは○○専門の□□です」形式 |
| 原則 | 3-5個の行動指針 |
| 成功基準 | チェックリスト形式で明確に |
| 出力形式 | テンプレートを提供 |

### 並列実行のガイドライン

- 単一メッセージで複数Task tool呼び出し
- 同時実行数は5-7程度を目安
- 依存関係がなければ並列、あれば順次
- 結果統合ステップを明示的に設ける

### アンチパターン

| 避けるべき | 理由 | 解決策 |
|-----------|------|--------|
| ファイル競合 | 同一ファイルを複数agentが編集 | 編集対象を事前分離 |
| 無制限並列 | トークン上限超過 | 同時実行数を制限 |
| ロール曖昧 | 一貫性のない出力 | 専門性を明確に定義 |
| 成功基準なし | 完了判断不能 | 具体的完了条件を列挙 |

---

## settings.json

### 推奨設定

```json
{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "permissions": {
    "deny": [
      "Read(./.env)",
      "Read(**/*.key)"
    ]
  }
}
```

### セキュリティ

- 機密ファイルは`deny`に追加
- 広範なBash許可を避ける
- 危険な操作は`ask`に設定

---

## CLAUDE.md

### 設計原則

1. **プロジェクト固有**: 汎用知識より具体的なルール
2. **簡潔**: 200行以下推奨
3. **構造化**: 表・箇条書きの活用

### 良いCLAUDE.mdの特徴

- プロジェクト構造の説明
- 重要なコマンド
- 固有の命名規則
- アーキテクチャ上の制約
- 開発ワークフロー

### 悪い例

- 一般的なプログラミング原則のみ
- Claudeが既に知っている情報の繰り返し
- 長すぎる（300行超）
- READMEとの重複

---

## チェック観点の優先度

| 優先度 | 意味 | 例 |
|--------|------|-----|
| Critical | 動作不能・セキュリティリスク | frontmatter欠損、機密ファイル公開 |
| High | 機能低下・トリガー不発 | description不明確、ツール権限過剰 |
| Medium | 保守性低下 | 行数超過、冗長性 |
| Low | スタイル・改善提案 | 命名、コメント |
| Info | ベストプラクティス提案 | 最適化アイデア |
