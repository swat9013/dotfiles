# 品質レビューチェックリスト

## スコープ

可読性、テスト品質、コード品質、モデリング、保守性など、コードの品質全般を検証。長期的なメンテナンス性を重視。

---

## Medium

### 設計判断（トレードオフ）
- [ ] 一般的な最適化パターンからの逸脱がある場合、意図的な選択か確認

### 可読性
- [ ] メソッド長が適切（目安: 20行以下）
- [ ] クラス長が適切（目安: 300行以下）
- [ ] ネストが深すぎない（目安: 3レベル以下）
- [ ] 変数名・関数名が明確
- [ ] マジックナンバーの定数化

### テスト品質（Khorikov 4本柱）
- [ ] 観察可能な振る舞いを検証しているか（実装詳細ではなく）
- [ ] リファクタリング耐性があるか（正当なリファクタリングで壊れないか）
- [ ] Mockは境界（管理されていない依存）にのみ使用しているか
- [ ] Stubの呼び出しを検証していないか（verify禁止）
- [ ] テストがビジネス要件と紐づいているか

### コード品質
- [ ] Lint/静的解析の警告なし
- [ ] 未使用のコード・インポートなし
- [ ] TODO/FIXMEにチケット番号あり

## Low

### モデリング提案（採用は実装者判断）

#### リソース vs イベント
- [ ] 更新されるデータ（リソース）と、過去の事実の記録（イベント）が混在していないか
- [ ] update/deleteで過去の事実が失われていないか（監査・履歴が必要なデータ）

#### エンティティ vs バリューオブジェクト
- [ ] IDで識別すべきもの（エンティティ）と、値で識別できるもの（VO）が適切に分離されているか
- [ ] 金額、メールアドレス、住所等がプリミティブ型のままになっていないか

#### データとロジックの凝集
- [ ] 関連するデータとロジックが同じ場所にまとまっているか
- [ ] ロジックがサービス層に漏れ出していないか（貧血ドメインモデル）

### コメント
- [ ] まずコメントより命名で表現できないか検討したか
- [ ] Why not（なぜ別の方法ではないか）が説明されているか
- [ ] コメントアウトされたコードがないか（Git管理すべき）
- [ ] 公開APIにドキュメントコメントがあるか

### 保守性
- [ ] YAGNI原則（必要最小限）
- [ ] 一貫した命名規則
- [ ] 適切なファイル配置

---

## 用語定義

### テスト品質の4本柱

| 柱 | 説明 |
|---|---|
| 退行に対する保護 | バグを検出する能力 |
| リファクタリング耐性 | 実装変更時に偽陽性を出さない（**最重要**） |
| 迅速なフィードバック | テスト実行が速い |
| 保守性 | テストの理解・変更が容易 |

### 観察可能な振る舞い vs 実装詳細

| 種類 | 検証すべきか |
|-----|------------|
| 公開API、最終出力、外部から見える副作用 | Yes |
| privateメソッド、内部状態、呼び出し順序 | No |

### テストダブル

| 種類 | 役割 | 検証してよいか |
|-----|------|--------------|
| Mock | 外向きの相互作用を模倣（副作用） | Yes |
| Stub | 内向きの相互作用を模倣（データ取得） | No |

### モデリング

| リソース | イベント |
|---------|---------|
| 現在状態を表す、CRUDで管理 | 過去の事実、不変、追記のみ |
| User, Order, Product | OrderPlaced, PaymentReceived |

| エンティティ | バリューオブジェクト |
|-------------|-------------------|
| IDで識別、状態変更あり | 値で識別、不変 |
| User(id=1) | Money(100, JPY), Email("a@b.com") |

**ロジック配置の優先順**:
1. バリューオブジェクト
2. エンティティ
3. ドメインサービス（どちらにも属さない場合のみ）
