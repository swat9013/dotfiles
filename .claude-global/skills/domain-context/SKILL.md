---
name: domain-context
description: プロジェクト固有のドメイン知識を管理する。「学びを保存」「ドメイン知識更新」「domain-context」と依頼された時に使用。
---

# Domain Context

プロジェクト固有のドメイン知識を抽出・永続化するスキル。

## 対象

| ファイル | 内容 |
|----------|------|
| プロジェクトCLAUDE.md | プロジェクト固有のドメイン知識を蓄積 |

## モード選択

| モード | 用途 | トリガー |
|--------|------|----------|
| Reflect | セッション会話から自動抽出 | **デフォルト**（`/domain-context`） |
| Manual | 手動で知識を抽出・追記 | ユーザーが明示的に内容を指定 |

## Manual モード

**注意**: Manual モードは親エージェントが直接実行する。サブエージェントは不要。

### 1. 抽出

セッション中の学びを特定:

| カテゴリ | 抽出対象 |
|----------|----------|
| アーキテクチャ | 構造、レイヤー、モジュール構成 |
| 技術選択 | Why付きの判断、トレードオフ |
| コーディング規約 | プロジェクト固有ルール |
| 落とし穴 | 実際にハマった問題・エラー |
| コマンド | 頻用ワークフロー・スクリプト |
| 依存関係 | 外部API・ライブラリの制約、バージョン固有の挙動 |
| データ構造 | 重要なスキーマ、型定義、データフローの特性 |
| 環境・設定 | 環境変数の意味、設定値の影響、環境差異 |
| 用語 | プロジェクト固有の概念、ドメイン用語の定義 |
| 境界条件 | エッジケース、想定外入力、許容範囲 |
| パフォーマンス | ボトルネック、最適化済み箇所、N+1等の注意点 |

### 2. 追記

- 既存セクションに追記、または新規セクション作成
- 重複確認: 同じ内容が既にないか
- 確認なしで即時追記

## Reflect モード

セッション会話からドメイン知識を自動抽出。

### 1. サブエージェントに分析委譲

**必須**: Task toolでサブエージェントを起動する。自分で直接分析しない。

| 設定 | 値 |
|------|-----|
| subagent_type | general-purpose |
| model | sonnet |

prompt構造:

```
ドメイン知識を抽出してください。

## セッション取得
~/.dotfiles/.claude-global/skills/domain-context/scripts/extract-messages.sh \
  "$(~/.dotfiles/.claude-global/skills/domain-context/scripts/find-session.sh)"

## 既存コンテキスト
- CLAUDE.md: ./CLAUDE.md
- rules/: ./.claude/rules/

## 抽出カテゴリ
| カテゴリ | 探すべきパターン |
|----------|-----------------|
| アーキテクチャ | 構造に関する発見・確認 |
| 技術選択 | 判断の理由・トレードオフ |
| コーディング規約 | プロジェクト固有ルール |
| 落とし穴 | 実際にハマった問題・エラー |
| コマンド | 有用なワークフロー・スクリプト |
| 依存関係 | 外部API・ライブラリの制約、バージョン固有の挙動 |
| データ構造 | 重要なスキーマ、型定義、データフローの特性 |
| 環境・設定 | 環境変数の意味、設定値の影響、環境差異 |
| 用語 | プロジェクト固有の概念、ドメイン用語の定義 |
| 境界条件 | エッジケース、想定外入力、許容範囲 |
| パフォーマンス | ボトルネック、最適化済み箇所、N+1等の注意点 |

## 除外基準
- 一時的な作業メモ
- 汎用的なベストプラクティス
- セッション限りの判断
- Claude設定の変更（config-optimizer の責務）

## 出力
templates/session-reflect-output.md 形式で報告
```

### 2. 整合性チェック

サブエージェントの結果を受け取った後、親エージェント（自分）が確認:

- 既存 CLAUDE.md との重複
- 既存 .claude/rules/ との矛盾
- 確信度の妥当性

**注意**: このステップは親エージェントが行う。サブエージェントは不要。

### 3. 保存

- 確認なしで即時追記
- 抽出結果を表示後、自動的に保存

## 追記後の行数チェック

追記完了後、CLAUDE.md の行数を確認:

```bash
wc -l ./CLAUDE.md
```

**150行を超えた場合**: `/context-optimizer` を自動呼び出し

## CLAUDE.md テンプレート

新規プロジェクトの場合:

```bash
cp ~/.dotfiles/.claude-global/skills/domain-context/assets/claude-md-template.md ./CLAUDE.md
```

## 成功基準

1. 学びが再利用可能な形で CLAUDE.md に永続化されている
2. 既存内容と重複・矛盾がない

## 原則

- **ドメイン知識のみ**: 汎用的なベストプラクティスではなく、このプロジェクト固有の知見
- **最小限の高シグナル情報**: 効果を最大化
- **具体性**: 抽象論ではなく、このプロジェクト固有の知識

## 参照ファイル

| ファイル | 用途 |
|---------|------|
| `templates/session-reflect-output.md` | 抽出結果テンプレート |
| `assets/claude-md-template.md` | 新規CLAUDE.mdテンプレート |
| `scripts/find-session.sh` | セッション特定スクリプト |
| `scripts/extract-messages.sh` | メッセージ抽出スクリプト |
