---
name: serena
description: Serena MCPサーバーの操作ガイド。セマンティックコード検索、シンボル参照追跡、精密編集のMCPツール仕様とベストプラクティスを含む。「Serena」「serena」「シンボル検索」「コード構造分析」「セマンティック検索」と依頼された時に参照する。
user-invocable: false
---

# Serena

LLMにセマンティックコード理解能力を提供するMCPサーバー。30以上の言語に対応し、シンボルレベルでの探索・編集を実現する。

## いつSerenaを使うか

**Serenaを選ぶべき場面**:

| 判断基準 | Serena | ビルトインツール（Glob/Grep/Read） |
|----------|--------|----------------------------------|
| 検索対象 | シンボル（関数・クラス・変数の定義） | 文字列パターン・ファイル名 |
| 目的 | 依存関係・影響範囲の把握 | ファイル内容の確認・文字列検索 |
| コードベース規模 | 大規模（数百〜数千ファイル） | 小〜中規模 |
| 操作の種類 | シンボル単位の精密な挿入・置換・削除 | 行ベースの編集 |

**Serenaを使わない場面**:
- 小規模プロジェクト（10-50ファイル）: Glob/Grep/Readで十分
- 単一ファイル編集: Edit/Readの方が高速
- 文字列の単純検索: Grepが適切
- 設定ファイル操作: 構造化されていないため効果限定的

---

## MCPツール一覧

### 探索系（読み取り専用）

| ツール | 役割 |
|--------|------|
| `find_symbol` | シンボルの定義場所を検索（名前・種類で絞り込み可） |
| `find_referencing_symbols` | 特定シンボルを参照する全箇所を発見 |
| `read_symbol` | シンボルの実装コードを読み取り |
| `list_symbols` | ファイル内の全シンボルを列挙 |
| `get_symbol_hierarchy` | クラス階層・継承関係を取得 |
| `get_file_outline` | ファイルの構造概要を取得 |

### 編集系

| ツール | 役割 |
|--------|------|
| `insert_after_symbol` | シンボル直後にコードを挿入（行番号不要） |
| `replace_symbol` | シンボル全体を新しい実装で置換 |
| `delete_symbol` | シンボルを削除 |

各ツールのパラメータ詳細はToolSearchで確認。`mcp__serena__`プレフィックス付きで呼び出す。

---

## 連携パターン

### パターン1: 影響範囲調査 → 安全な変更

```
find_symbol → find_referencing_symbols → read_symbol（各参照箇所） → 変更判断
```

シンボルを変更・削除する前に、必ず影響範囲を把握する。

### パターン2: 未知のコードベース探索

```
find_symbol（キーワードで探す） → read_symbol（実装確認） → find_referencing_symbols（呼び出し階層を辿る）
```

エントリーポイントを見つけ、参照を辿って処理フローを理解する。

### パターン3: リファクタリング

```
find_symbol → find_referencing_symbols → replace_symbol（定義を更新） → Edit（呼び出し箇所を更新）
```

定義の変更はreplace_symbol、呼び出し箇所の更新はEditツールで。

### パターン4: 構造把握

```
get_file_outline（ファイル構造） → list_symbols（詳細） → get_symbol_hierarchy（継承関係）
```

コードベースの全体像を素早く把握する。

---

## 注意点

- `delete_symbol`の前にfind_referencing_symbolsで依存がないことを確認
- replace_symbolはシンボル全体を置換する。部分的な変更にはEditツールを使う
- シンボルとして認識されない要素（コメント、設定値等）にはビルトインツールを使う
- LSPの起動に数秒かかる場合がある。初回呼び出し時のレイテンシは正常

## 成功基準

1. 適切な場面でSerena/ビルトインの使い分けができた
2. 影響範囲を漏れなく把握してから変更を実施できた
3. シンボルレベルの精密な探索・編集が完了した

## 完了チェックリスト

- [ ] 変更前にfind_referencing_symbolsで影響範囲を確認した
- [ ] シンボル操作後にコードの整合性が保たれている
- [ ] 探索で必要な情報（定義・参照・実装）が取得できた
