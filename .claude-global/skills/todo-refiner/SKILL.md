---
name: todo-refiner
description: |
  .work/todo.mdをINVEST原則に沿って整理する。
  「todo整理」「タスク整理」「todo-refiner」と依頼されたときに使用。
  整理後のタスクは`tt`コマンドでClaude Codeに直接渡せる品質になる。
---

# Todo Refiner

## 概要

`.work/todo.md`のタスクを「価値+完了条件」形式に整理し、AIに直接渡して作業委譲できる品質にする。

## 前提条件

- カレントディレクトリに`.work/todo.md`が存在すること

## 整理後フォーマット

```
- [ ] タスク内容。価値: 〜。完了: 〜
```

## ワークフロー

### Step 1: 読み込み・分析

カレントディレクトリの`.work/todo.md`を読み込み、各タスクを以下に分類:

| 分類 | 条件 | 処理 |
|-----|------|------|
| 明確 | What/Why/Doneが推測可能 | 自動整理 |
| 曖昧 | 何をするか不明 | 質問で具体化 |
| 方針 | 心がけ・ルール的 | 設定タスクに変換 |
| 複合 | 句点で複数事項 | 分割 |

### Step 2: ネスト処理

| パターン | 処理 |
|---------|------|
| ネストしたバレット（`-`） | 親の補足情報として統合 |
| ネストしたチェックボックス（`- [ ]`） | 単独で意味をなさないなら親に統合、意味があれば独立タスク化 |

### Step 3: 曖昧タスクの具体化

曖昧なタスクには`AskUserQuestion`で質問する。必ず選択肢を提示:

```
例: 「claude codeの長時間実行」
→ 質問: 「このタスクで何を達成したいですか？」
  - 選択肢1: コンテキスト保持の改善
  - 選択肢2: メモリ使用量の最適化
  - 選択肢3: セッション管理の設定
```

### Step 4: プレビュー・確認

整理案を全タスク分表示し、ユーザー確認後にカレントディレクトリの`.work/todo.md`を上書き。

## 整理例

### Before

```markdown
- [ ] TDDを要所で使う。リファクタリング、バグ修正、APiが決まっている
  -  バグを直すときはテストを先にする
  -  t-wadaのレガシーコード改善ガイドを使う
- [ ] ターミナルタイトルを変える
```

### After

```markdown
- [ ] CLAUDE.mdにTDDルールを追加する（バグ修正時はテスト先行、t-wadaガイド参照）。価値: AIがTDDを適切に使用。完了: rules/に記載済み
- [ ] ターミナルタイトルをカレントディレクトリ名に変更する。価値: 複数タブの識別が容易に。完了: ghostty設定変更済み
```

## 注意事項

- 完了済みタスク（`- [x]`）は整理対象外
- 整理後もGFM互換を維持（`tt`コマンドで正常動作）

## 参照

- `references/invest-guide.md`: INVEST原則の詳細
