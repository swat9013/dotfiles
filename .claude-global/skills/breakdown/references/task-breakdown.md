# タスク分解のベストプラクティス

`/breakdown` コマンドでタスク分解する際のガイドライン。

---

## 構造整理と機能追加を分ける（TidyFirst）

構造整理を先に行い、整理された状態で機能追加する。

```
Phase 1: 構造整理（リファクタリング）
- TASK-001 **P**: 重複コードの共通化
- TASK-002 **P**: レイヤー境界の明確化

Phase 2: 機能追加
- TASK-003: 新機能実装（TASK-001, TASK-002完了後）
```

**理由**:
- 整理された状態での機能追加は実装効率向上
- バグリスク減少、レビュー効率向上
- 各タスクの責任が明確化

---

## TDD前提のタスク分割

テスト追加タスクと実装タスクを分離する。

```
TASK-001 **P**: UserRepository.findById() テスト追加
  - 種別: テスト追加
  - 成功基準: 正常系・エラー系の振る舞い定義

TASK-002: UserRepository.findById() 実装
  - 種別: 新機能実装
  - 依存: TASK-001
  - 成功基準: TASK-001のテストが全通過
```

**理由**:
- テストと実装の責任が明確
- Red-Green-Refactor サイクルが追跡可能
- 並列実行が容易（テスト定義を並列で進める）

---

## タスク粒度の目安

| 難易度 | 推定時間 | 性質 |
|-------|---------|------|
| 易 | 0.5-1h | 単純な追加・修正、既存パターン踏襲 |
| 中 | 1-2h | 新規機能、設計判断が必要 |
| 難 | 2-3h | 複雑なロジック、アーキテクチャ変更 |

**3時間以上かかる場合はさらに分解すること。**

各タスクは明確な1成果物（関数・ファイル・機能単位）を生む自己完結単位にする。

---

## 並列実行マーク（P）

タイトル末尾に `**P**` を付与する基準:

- 依存タスクがない
- 他タスクと同じファイルを編集しない
- 独立して実行可能

**並列バッチ上限**: サブエージェント同時起動は最大7。Pマーク付きタスクが8個以上ある場合、ファイル近接性や機能グループで7個以下のバッチに分割する。

---

## 依存グラフ設計パターン

### ダイヤモンド依存

複数の独立タスクが1つの統合タスクに合流するパターン。

```
TASK-001 **P**: API実装
TASK-002 **P**: UI実装
TASK-003: 統合テスト
  - 依存: TASK-001, TASK-002
```

### Phase間ゲート依存

前Phaseの品質ゲート通過を次Phaseの前提とする。

```
Phase 1:
  TASK-001 **P**, TASK-002 **P**
  品質ゲート: lint/test 通過

Phase 2:
  TASK-003: ...
    - 依存: Phase 1 完了
```

`依存: Phase N 完了` で前Phase全体の完了を前提条件として表現する。
