---
paths: "**/.claude/agents/**"
---

# Agents 作成ガイド

`.claude/agents/` 配下のエージェント定義を作成・編集する際のガイドライン。

## Agents とは

Task toolで起動される独立したサブエージェント。コンテキストを分離して並列実行や専門的な役割分担を実現する。

## ファイル形式

```yaml
---
name: agent-name
description: |
  エージェントの説明。
  Task toolで「agent-name」として呼び出される。

# 許可するツール
tools:
  - Read
  - Glob
  - Grep
  - WebSearch

# 許可するBashコマンド（オプション）
allowedCommands:
  - npm test
  - npm run lint
---

# エージェント名

## ロール
このエージェントの役割定義

## 原則
- 原則1
- 原則2

## 成功基準
何をもって完了とするか

## 出力形式
期待される出力の形式
```

## Agents vs Skills 判断基準

| 判断基準 | Agents | Skills |
|---------|--------|--------|
| 並列実行が必要 | Yes | No |
| 試行錯誤・実験的作業 | Yes | No |
| 専門的な役割分担 | Yes | No |
| コンテキスト分離が必要 | Yes | No |
| 対話しながら進める | No | Yes |
| 会話の流れを維持 | No | Yes |

### 具体例

**Agents向き**:
- 複数ファイルの並列検索
- テスト実行と結果収集
- 複数アプローチの比較検討

**Skills向き**:
- コードレビュー（対話が必要）
- 設計相談（段階的な決定）
- デバッグ（状況に応じた判断）

## プロンプト構造

### 1. ロール定義

エージェントの専門性と責任範囲を明確に。

```markdown
## ロール
あなたはセキュリティ専門のコードレビュアーです。
脆弱性の検出と対策提案に集中してください。
```

### 2. 原則

行動指針を箇条書きで。

```markdown
## 原則
- OWASP Top 10 を基準に評価
- False positive より False negative を避ける
- 具体的な修正コードを提示
```

### 3. 成功基準

完了条件を明確に。

```markdown
## 成功基準
- すべてのエンドポイントをレビュー完了
- 発見した脆弱性をリスクレベル付きで報告
- 各脆弱性に対策を提示
```

### 4. 出力形式

構造化された出力を指定。

```markdown
## 出力形式
### 発見した脆弱性
| ファイル | 行 | 種別 | リスク | 対策 |
|---------|----|----|------|------|

### サマリー
全体的な評価と推奨事項
```

## 並列実行ガイドライン

複数エージェントを並列実行する場合の注意点。

### 推奨パターン

```markdown
# 読み取り専用の並列実行
Task tool で以下を並列起動:
- security-reviewer: セキュリティ観点
- performance-reviewer: パフォーマンス観点
- architecture-reviewer: アーキテクチャ観点
```

### 避けるべきパターン

```markdown
# ファイル編集の並列実行 → 競合の危険
Task tool で以下を並列起動:
- formatter-agent: コード整形
- refactor-agent: リファクタリング
→ 同じファイルを編集すると競合
```

## アンチパターン

| パターン | 問題点 | 対策 |
|---------|--------|------|
| ファイル競合 | 複数エージェントが同じファイルを編集 | 読み取り専用 or 順次実行 |
| ロール曖昧 | 何をするエージェントか不明確 | 専門性を明確に定義 |
| 広すぎるツール許可 | 意図しない操作の危険 | 必要最小限のツールに制限 |
| 成功基準なし | 完了判断できない | 明確な完了条件を定義 |

## ツール制限の設計

### 読み取り専用エージェント

```yaml
tools:
  - Read
  - Glob
  - Grep
```

### テスト実行エージェント

```yaml
tools:
  - Read
  - Glob
  - Grep
  - Bash
allowedCommands:
  - npm test
  - npm run lint
```

### 編集可能エージェント（慎重に）

```yaml
tools:
  - Read
  - Glob
  - Grep
  - Edit
  - Write
```
