# リファクタリング計画

## 基本情報

- **作成日**: {{DATE}}
- **対象**: {{TARGET}}
- **ステータス**: Draft

---

## 1. 安全性評価

### テストカバレッジ

| 項目 | 状態 |
|------|------|
| カバレッジレベル | {{HIGH/MEDIUM/LOW/NONE}} |
| テストファイル | {{テストファイル一覧}} |
| 未カバー箇所 | {{カバーされていない箇所}} |

### 影響範囲

| 項目 | 値 |
|------|-----|
| 影響ファイル数 | {{N}}ファイル |
| 影響レベル | {{HIGH/MEDIUM/LOW}} |
| 主な参照元 | {{参照元一覧}} |

### リスク判定

**総合リスク**: {{CRITICAL/HIGH/NORMAL}}

{{リスクに応じた対応方針を記載}}

---

## 2. 検出されたスメル

| # | スメル | 箇所 | 深刻度 | 対処法 |
|---|--------|------|--------|--------|
| 1 | {{スメル名}} | {{ファイル:行}} | {{HIGH/MEDIUM/LOW}} | {{手法}} |
| 2 | {{スメル名}} | {{ファイル:行}} | {{HIGH/MEDIUM/LOW}} | {{手法}} |

---

## 3. リファクタリングステップ

各ステップは15-30分で完了可能なサイズ。1ステップ1コミット。

### Step 1: {{手法名}} - {{対象}}

**目的**: {{このステップで達成すること}}

**変更内容**:
- {{変更1}}
- {{変更2}}

**影響ファイル**:
- {{ファイル1}}

**検証方法**:
- [ ] テスト実行: `{{TEST_COMMAND}}`
- [ ] Lint実行: `{{LINT_COMMAND}}`

**コミットメッセージ**:
```
refactor: {{手法名}} - {{対象}}

- Before: {{変更前}}
- After: {{変更後}}
- Technique: {{手法名}}
- Smell: {{解消するスメル}}
```

---

### Step 2: {{手法名}} - {{対象}}

{{同様の構造}}

---

## 4. 品質ゲート

各ステップ完了時に実行:

| チェック | コマンド |
|---------|---------|
| テスト | `{{TEST_COMMAND}}` |
| Lint | `{{LINT_COMMAND}}` |
| 型チェック | `{{TYPE_CHECK_COMMAND}}` |

**失敗時の対応**:
1. `git checkout .` で即座にロールバック
2. 失敗原因を分析
3. ステップを再分割するか方針を再検討

---

## 5. 完了条件

- [ ] 全ステップが完了
- [ ] 全テストが通過
- [ ] 検出したスメルが解消
- [ ] 振る舞いが保存されている（外部から見た動作が同一）

---

## 6. ロールバック計画

問題発生時の復旧手順:

1. 最後の安定コミットを特定: `git log --oneline`
2. ロールバック実行: `git reset --hard {{commit_hash}}`

**安全なロールバックポイント**:
- {{コミットハッシュ}}: {{説明}}

---

## 参考資料

- [Refactoring Catalog](https://refactoring.com/catalog/)
- [Code Smells](https://refactoring.guru/refactoring/smells)
