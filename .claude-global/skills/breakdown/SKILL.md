---
name: breakdown
description: |-
  plan.mdからimplementation.mdを生成するタスク分解エージェント。
  実装計画を実行可能なタスクリストに変換する。
  「/breakdown」「ブレイクダウン」「タスク分解」「実装計画を作って」「implementation.md生成」「タスクに分解」「実装タスク」と依頼された時に使用。
disable-model-invocation: true
---

# /breakdown コマンド

plan.md の実装方針から implementation.md を生成する。

## 役割分担

- **plan.md**: 「何を作るべきか」「なぜその設計が良いのか」（設計判断）
- **implementation.md**: 「どう実装するか」の詳細タスクリスト（実行計画）

## 前提条件

以下を確認してから実行。満たさない場合は中止し理由を報告:

1. plan.md が存在する
2. plan.md に実装方針・フェーズ分けが含まれている

## 実行手順

### 1. 引数解析
- 引数あり: 指定パスの plan.md を使用
- 引数なし: プロジェクトルート直下の plan.md を使用

### 2. コンテキスト読み込み
- plan.md の内容を読み込み
- CLAUDE.md でプロジェクト固有の制約を確認
- package.json / Makefile / CLAUDE.md から lint/test/build コマンドを特定。未確定の場合は品質ゲートに `[NEEDS CLARIFICATION]` を挿入

### 3. タスク分解

plan.md の各フェーズを 1-2時間粒度のタスクに分解。
各タスクは明確な1成果物（関数・ファイル・機能単位）を生む自己完結単位にする。
不明点は `[NEEDS CLARIFICATION: 質問]` を挿入（最大3箇所）:

| 項目 | 内容 |
|-----|------|
| タスクID | TASK-001 形式 |
| タイトル | 具体的な作業内容。簡潔かつ自己説明的に（時間・難易度は推定フィールドへ） |
| 推定 | 時間・難易度（例: 2h・中）。タイトルとは別フィールドで記述 |
| タスク種別 | 新機能実装 / リファクタリング / テスト追加 / バグ修正 / ドキュメント / フロントエンド・UI実装 |
| 目的 | なぜ必要か |
| 実装内容 | ファイルパス、修正箇所 |
| 成功基準 | テスト条件、確認項目 |
| 依存タスク | 下記の依存表記ルールに従う |
| 並列実行可否 | **P** マークで明示 |

### 4. 並列実行可能タスクの特定

**Pマーク付与基準**:
- 依存タスクがない
- 他タスクと同じファイルを編集しない
- 独立して実行可能

### 5. implementation.md 保存

プロジェクトルート直下に保存。

テンプレート: `~/.claude/skills/breakdown/templates/implementation.md`

### 6. タスク分解レビュー

生成した implementation.md の品質を自動検証する。

**実行方式**: opus サブエージェント（Task tool, `model: opus`）に委譲。生成バイアスを排除するためコンテキスト分離で実行。

**サブエージェントへの入力**:
- 生成した implementation.md の全文
- 元の plan.md の全文
- レビュー観点の指示（下記7カテゴリ）

**レビュー観点**: `~/.claude/skills/breakdown/references/review-criteria.md` の7カテゴリ
1. 推定精度 — plan.md との乖離、分析系タスクの過小評価
2. タスク粒度 — 3h超、複数変更の混在
3. 依存関係の完全性 — Pマーク付き同士のファイル衝突
4. plan.md との整合性 — 要件未カバー、フェーズ構成の乖離
5. タスク種別の正確性 — 種別と実装内容の不一致
6. 成功基準の具体性 — 主観的表現のみ
7. テスト配置の明確性 — ファイルパス・種別の欠落

**出力形式**: 前提テーブル（フェーズ数/タスク数/推定合計/plan.md推定/乖離率）→ 問題点（番号付き、重要度 高/中/低 + カテゴリ + TASK-ID）→ 良い点 → 修正推奨テーブル（#/重要度/対応）

**レビュー後のフロー**:
1. レビュー結果をユーザーに表示
2. AskUserQuestion で修正適用の可否を確認（はい / いいえ / 一部適用）
3. 「はい」→ 全修正を Edit で implementation.md に適用
4. 「一部適用」→ 適用する修正番号を確認し、選択分のみ適用
5. 「いいえ」→ 修正せず完了

## 依存表記ルール

| 表記 | 意味 |
|------|------|
| `なし` | 独立タスク |
| `TASK-001, TASK-002` | 特定タスクへの依存（カンマ区切り） |
| `Phase N 完了` | 前フェーズの品質ゲート通過が前提 |

## タスク分解のベストプラクティス

→ 詳細: `~/.claude/skills/breakdown/references/task-breakdown.md`

| パターン | 概要 |
|---------|------|
| TidyFirst | 構造整理を先に、機能追加は後で |
| TDD分割 | テスト追加と実装を分離 |
| 粒度目安 | 易(0.5-1h)、中(1-2h)、難(2-3h)、3h超は分解 |
| 依存グラフ | ダイヤモンド依存、Phase間ゲート依存 |

## 出力形式

```
## implementation.md 生成完了

**保存先**: implementation.md
**タスク数**: X個
**フェーズ数**: X
**並列実行可能**: X個（Pマーク付き）
```

レビュー結果を表示後、修正適用の確認ダイアログ:

```
修正を適用しますか？
- はい（全修正を適用）
- いいえ（修正せず完了）
- 一部適用（適用する修正を選択）
```

修正完了（または修正なし）後:

```
**次のステップ**:
- `/implement` で自動実行
- または手動で順次実装
```

## 成功基準

このコマンドの実行は以下を満たしたとき成功とみなす:

1. plan.md の全フェーズが 1-2時間粒度のタスクに分解されている
2. 各タスクに種別・推定時間・難易度・成功基準が明記されている
3. 並列実行可能タスクに Pマークが付与されている
4. implementation.md がプロジェクトルートに保存されている
5. レビュー結果がユーザーに提示されている

## 完了チェックリスト

- [ ] 全フェーズがタスク化されている
- [ ] 各タスクに推定・難易度・種別が明記されている
- [ ] ファイルパス・修正箇所が具体的
- [ ] 成功基準が測定可能
- [ ] 依存関係が依存表記ルールに従っている
- [ ] 並列実行可能タスクにPマーク付与
- [ ] 品質ゲートのコマンドが具体的（未確定なら [NEEDS CLARIFICATION]）
- [ ] タスク記述の充足性:
  - [ ] 目的が具体的（何を・なぜ）
  - [ ] 実装内容の範囲・制約が明確
  - [ ] ファイルパスが具体的（パス:行番号）
  - [ ] 成功基準が測定可能
- [ ] レビュー指摘が確認済み（または修正適用済み）
