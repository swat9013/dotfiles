# コードスメルカタログ

リファクタリングのトリガーとなるコードスメル15種と対処法。

## 1. Bloaters（肥大化）

コードが過度に大きくなり、扱いにくくなっている状態。

### 1.1 Long Method

**症状**: メソッドが長すぎる（目安: 20行超）

**兆候**:
- スクロールしないと全体が見えない
- 複数の抽象レベルが混在
- コメントで区切られたブロックがある

**対処法**:
- **Extract Method**: コードブロックを新メソッドに抽出
- **Replace Temp with Query**: 一時変数をメソッド呼び出しに置換

**深刻度**: MEDIUM

---

### 1.2 Large Class

**症状**: クラスが多くの責務を持ちすぎている

**兆候**:
- フィールドが10個以上
- メソッドが多すぎる
- 関連性の低いメソッド群がある

**対処法**:
- **Extract Class**: 責務を分離して新クラス作成
- **Extract Subclass**: サブクラスとして分離

**深刻度**: HIGH

---

### 1.3 Long Parameter List

**症状**: パラメータが多すぎる（目安: 4つ以上）

**兆候**:
- 呼び出し側で引数の順序を間違えやすい
- 似たようなパラメータが複数メソッドに出現

**対処法**:
- **Introduce Parameter Object**: パラメータをオブジェクトにまとめる
- **Preserve Whole Object**: オブジェクト全体を渡す

**深刻度**: MEDIUM

---

### 1.4 Primitive Obsession

**症状**: プリミティブ型への過度な依存

**兆候**:
- 文字列で複雑なデータを表現
- 数値に特別な意味がある（マジックナンバー）
- 配列で異種データを扱う

**対処法**:
- **Replace Data Value with Object**: 値オブジェクトを導入
- **Replace Type Code with Class**: 型コードをクラスに置換

**深刻度**: MEDIUM

---

### 1.5 Data Clumps

**症状**: 常に一緒に現れるデータの群れ

**兆候**:
- 同じ3つ以上のフィールドが複数クラスに出現
- 同じパラメータの組み合わせが複数メソッドに出現

**対処法**:
- **Extract Class**: データ群をクラスにまとめる
- **Introduce Parameter Object**: パラメータ群をオブジェクト化

**深刻度**: MEDIUM

---

## 2. Change Preventers（変更の障害）

変更が困難になる構造的問題。

### 2.1 Divergent Change

**症状**: 1つのクラスが複数の理由で変更される

**兆候**:
- 「機能Aを変更するときはこのメソッド群」「機能Bはこっち」
- 異なる関心事が1クラスに混在

**対処法**:
- **Extract Class**: 各関心事を別クラスに分離

**深刻度**: HIGH

---

### 2.2 Shotgun Surgery

**症状**: 1つの変更が複数クラスに波及

**兆候**:
- 小さな変更で多くのファイルを編集
- 同じ変更パターンが散在

**対処法**:
- **Move Method/Field**: 関連する機能を1箇所に集約
- **Inline Class**: 過度に分散したクラスを統合

**深刻度**: HIGH

---

### 2.3 Parallel Inheritance Hierarchies

**症状**: 継承階層が並列化している

**兆候**:
- クラスAにサブクラスを追加すると、クラスBにも対応するサブクラスが必要

**対処法**:
- **Move Method/Field**: 一方の階層を他方に統合

**深刻度**: MEDIUM

---

## 3. Dispensables（不要な要素）

削除しても問題ない、または削除すべき要素。

### 3.1 Duplicate Code

**症状**: 同じまたは類似のコードが複数箇所に存在

**兆候**:
- コピペされたコードブロック
- わずかな違いしかない類似メソッド

**対処法**:
- **Extract Method**: 共通部分を抽出
- **Pull Up Method**: 共通メソッドを親クラスへ移動
- **Form Template Method**: テンプレートメソッドパターン適用

**深刻度**: HIGH

---

### 3.2 Dead Code

**症状**: 使われていないコード

**兆候**:
- 到達不能なコードブロック
- 呼び出されないメソッド
- 使われない変数・パラメータ

**対処法**:
- **削除**: バージョン管理で復元可能なので躊躇なく削除

**深刻度**: LOW

---

### 3.3 Lazy Class

**症状**: 存在価値の薄いクラス

**兆候**:
- メソッドが1-2個しかない
- 委譲するだけで独自ロジックがない
- リファクタリングで小さくなりすぎた

**対処法**:
- **Inline Class**: 使用側に統合
- **Collapse Hierarchy**: 継承階層を平坦化

**深刻度**: LOW

---

### 3.4 Speculative Generality

**症状**: 「将来使うかも」で作られた過度な汎用化

**兆候**:
- 使われていない抽象クラス・インターフェース
- 不要なパラメータ
- 意味のないメソッド委譲

**対処法**:
- **Collapse Hierarchy**: 不要な階層を削除
- **Inline Class/Method**: 不要な抽象化を削除

**深刻度**: MEDIUM

---

## 4. Couplers（結合度の問題）

クラス間の過度な結合。

### 4.1 Feature Envy

**症状**: メソッドが自クラスより他クラスのデータを多用

**兆候**:
- 他オブジェクトのgetterを多用
- 他オブジェクトのデータで計算

**対処法**:
- **Move Method**: データを持つクラスへメソッドを移動

**深刻度**: MEDIUM

---

### 4.2 Inappropriate Intimacy

**症状**: クラス間の過度な依存

**兆候**:
- 互いのprivateフィールドにアクセス
- 双方向の参照
- 継承の乱用

**対処法**:
- **Move Method/Field**: 責務を適切なクラスに移動
- **Extract Class**: 共通部分を別クラスに抽出
- **Replace Inheritance with Delegation**: 継承を委譲に変更

**深刻度**: HIGH

---

### 4.3 Message Chains

**症状**: 連鎖的なメソッド呼び出し

**兆候**:
- `a.getB().getC().getD().doSomething()`
- オブジェクトの内部構造への依存

**対処法**:
- **Hide Delegate**: 委譲先を隠蔽
- **Extract Method + Move Method**: 適切な場所にメソッドを配置

**深刻度**: MEDIUM

---

## 深刻度判定基準

| 深刻度 | 条件 | アクション |
|--------|------|----------|
| HIGH | 変更困難 or 重複 | 早期対処推奨 |
| MEDIUM | 可読性低下 | 計画的対処 |
| LOW | 軽微な問題 | 機会があれば対処 |

## スメル検出チェックリスト

Phase 1のスメル検出で使用するチェックリスト:

```
□ メソッドは20行以下か
□ クラスは単一責任か
□ パラメータは3つ以下か
□ 重複コードはないか
□ 使われていないコードはないか
□ 他クラスのデータを過度に使っていないか
□ 変更が複数ファイルに波及しないか
```
