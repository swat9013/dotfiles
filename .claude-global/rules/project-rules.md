---
paths: "**/.claude/rules/**"
---

# Rules 作成ガイド

`.claude/rules/` 配下のルールファイルを作成・編集する際のガイドライン。

## Rules とは

特定のパスにアクセスした際に自動適用されるコンテキスト固有のガイドライン。frontmatterの `paths` で指定したglob patternにマッチするファイルを開くと、そのルールが自動的に適用される。

## ファイル制約

- **推奨サイズ**: 200行以下
- **命名規則**: kebab-case（例: `api-endpoints.md`, `test-files.md`）
- **形式**: Markdown + YAML frontmatter

## frontmatter 形式

```yaml
---
paths: src/**/*.ts          # 単一パターン
---
```

```yaml
---
paths:                      # 複数パターン（配列）
  - "src/api/**"
  - "src/services/**"
---
```

```yaml
---
paths:                      # 除外パターン
  - "**/*.test.ts"
  - "!**/__mocks__/**"      # ! で除外
---
```

## Rules vs CLAUDE.md vs skills

| 判断基準 | rules/ | CLAUDE.md | skills/ |
|---------|--------|-----------|---------|
| 適用範囲 | パス固有 | プロジェクト全体 | 明示的に呼び出し |
| 適用方式 | 自動（パスマッチ） | 自動（常時） | 手動 or キーワード |
| 内容 | 特定ファイル種別の制約 | 全体的な方針 | ワークフロー・手順 |
| 例 | 「API層ではエラーを必ずログ」 | 「KISS原則を守る」 | 「コードレビュー実施」 |

### 使い分け判断フロー

1. **特定パスでのみ適用?** → rules/
2. **プロジェクト全体で常に適用?** → CLAUDE.md
3. **手順やワークフロー?** → skills/

## 良いRulesの特徴

- **パス固有**: globで明確に絞り込める
- **短く具体的**: 200行以下で要点を伝える
- **自己完結**: 他ファイル参照なしで理解可能
- **アクション指向**: 「〜すること」「〜しないこと」が明確

## ルール内容の構成例

```markdown
---
paths: src/api/**
---

# API層のガイドライン

## 必須事項
- すべてのエンドポイントでエラーハンドリング
- リクエスト/レスポンスの型定義必須

## 禁止事項
- 直接のDB操作（サービス層経由）
- コンソールログ（ロガー使用）

## 命名規則
- エンドポイント: RESTful形式
- ファイル名: `{resource}.controller.ts`
```

## アンチパターン

### 避けるべきケース

| パターン | 問題点 | 代替案 |
|---------|--------|--------|
| globで絞れない汎用的な内容 | 全ファイルに適用 = CLAUDE.md | CLAUDE.mdに記載 |
| 長い手順（300行超） | ルールではなくワークフロー | skills/に分離 |
| 複数ルールで同じ内容 | DRY違反 | CLAUDE.mdまたは共通rulesに集約 |
| 実装詳細の羅列 | ルールではなくドキュメント | docs/に移動 |

### 悪い例

```yaml
---
paths: "**/*"              # 広すぎる → CLAUDE.mdへ
---
```

```yaml
---
paths: src/**
---
# 以下500行の詳細手順...  # 長すぎる → skills/へ
```

## ルールファイルの分割基準

1ファイルが200行を超える場合:
- 関心事ごとに分割（例: `api-validation.md`, `api-error-handling.md`）
- 共通部分はCLAUDE.mdに昇格
