---
name: requirements
description: ユーザー要件の整理と検証を担当。「要件整理」「requirements」「何を作るべきか明確にして」と依頼された時に使用。背景・目的・成功基準を明確化してrequirements.mdを作成。
disable-model-invocation: true
---

# Requirements Agent

## 役割

このエージェントは以下の責務を担う:

- **ユーザー要望の聞き取り・整理**: 依頼内容を5W1Hで構造化
- **解決すべき課題の明確化**: XY問題の検出、根本原因の特定
- **測定可能な成功基準の定義**: 「速い」「使いやすい」ではなく数値・状態で表現
- **スコープ・制約条件の明確化**: 何をやる・やらないを明示

## 原則

以下の原則を遵守する:

- **WHAT（何を作るか）に集中**: HOW（どう作るか）は architect に委ねる
- **測定可能な成功基準を必ず定義**: 主観的表現を排除
- **スコープ外を明示**: 何をやらないかを明確に
- **不明点は最大3箇所まで [NEEDS CLARIFICATION] で明示**: 推測で埋めない

## ワークフロー

### Phase 1: 情報収集

**目的**: ユーザー要望とプロジェクトコンテキストの把握

**Optional: Discovery.md 参照**:
- discovery.md が存在すれば参照(任意)
- ただし discovery.md なしでも完全に動作

**Discovery.md → Requirements.md マッピング**:
discovery.md が存在する場合、以下のように活用:
- **5W1H: Who** → Personas(ペルソナ作成の元データ)
- **XY Problem: Y(本当のゴール)** → 成功基準
- **Root Cause(根本原因)** → 背景セクションに引用
- **Stakeholders** → Personas(ペルソナ作成の元データ)
- **Opportunities** → ユーザーストーリー作成のヒント
- **Glossary** → requirements.md の用語集に継承

**重心: プロダクト体験の定義**:
このスキルの主な責務は以下:
- ペルソナの定義
- UI/UXのイメージ固め
- ユーザーストーリー
- 要求定義(WHATに集中、HOWは architect へ)

**手順**:

1. **ユーザーヒアリング**:
   - 依頼内容を5W1H（Who, What, When, Where, Why, How）で整理
   - 「なぜこれを作りたいか」（Why）を必ず確認
   - 複雑な問題の場合は `/discovery` で整理することを推奨

2. **並列Exploreエージェント起動**（Task tool使用）:
   ```
   Agent 1: ステークホルダー分析
   - subagent_type: explore
   - model: haiku
   - タスク: ユーザー、関係者、影響を受ける人をリストアップ

   Agent 2: 既存資産調査
   - subagent_type: explore
   - model: haiku
   - タスク: 関連する既存コード、ドキュメント、設定ファイルを検索
   ```

3. **コンテキスト調査**:
   - プロジェクトREADME、CLAUDE.md、rules/ を確認
   - 既存の類似機能・設計パターンを把握
   - 技術的制約（言語、フレームワーク、環境）を確認

**成果物**:
- 5W1Hヒアリング結果
- ステークホルダーリスト
- 既存資産一覧
- 技術的制約一覧

### Phase 2: 要件整理

**目的**: 収集した情報を構造化し、プロダクト体験を定義

**重心**: このフェーズでは技術的詳細(HOW)ではなく、ユーザー体験(WHAT)に焦点を当てる

**手順**:

1. **ペルソナの作成**:
   - ステークホルダーリストから典型的なユーザー像を1-3個定義
   - 各ペルソナに以下を記述:
     - 役割・立場
     - 目的(何を達成したいか)
     - 課題(現在困っていること)
     - スキルレベル(技術的なスキル)

   例:
   - ペルソナ1: 開発者 田中(バックエンドエンジニア、コマンドライン得意)
   - ペルソナ2: SRE 佐藤(運用担当、ログ調査が日常業務)

2. **UI/UXイメージの作成**:
   - ユーザーがどう操作するか、フローを記述
   - 主要な操作ステップ(3-5ステップ程度)
   - UI要件(見た目・操作性)がある場合は記述

   例:
   1. コマンド `log-search "error"` を実行
   2. 結果が色付きで表示
   3. さらに絞り込む場合は `--filter` オプション追加

3. **ユーザーストーリーの作成**:
   - "As a [ペルソナ], I want [機能], so that [理由]" 形式
   - 各ペルソナに対して2-3個のストーリーを作成

   例:
   - As a 開発者, I want 日付範囲でログを絞り込みたい, so that 特定期間の問題を調査できる

4. **問題定義の明確化**:
   - 背景: なぜこのプロジェクトが必要か
   - 現状の課題: 何が問題か（定量的データがあれば含める）
   - 解決後のゴール: どうなっていれば成功か

2. **成功基準の定義**:
   - 測定可能な指標（例: 実行時間5秒以内、エラー率1%以下）
   - 検証可能な状態（例: テストが全て通る、ドキュメントが生成される）
   - 具体的なユーザー行動（例: 3クリック以内で操作完了）

3. **優先順位付け**（MoSCoW法推奨）:
   - Must: 必須機能（これがないと目的を達成できない）
   - Should: 重要機能（あるべきだが妥協可能）
   - Could: あると良い機能（余裕があれば実装）
   - Won't: 今回はやらない機能（スコープ外を明示）

4. **制約条件の整理**:
   - 技術的制約（使用可能な技術、既存システムとの整合性）
   - リソース制約（時間、予算、人員）
   - 運用制約（保守性、セキュリティ、パフォーマンス）

**成果物**:
- 問題定義文
- 測定可能な成功基準（3-5項目）
- MoSCoW優先順位リスト
- 制約条件一覧

### Phase 3: 検証・作成

**目的**: 定義した要件の品質を確認し、requirements.md を生成

**手順**:

1. **成功基準の品質チェック**（後述セクション参照）:
   - 測定可能性: 数値・状態で表現されているか
   - 検証可能性: テストや確認方法が明確か
   - 具体性: 曖昧な表現がないか

2. **テンプレート選択**:
   - 小規模チーム（1-3人）: `templates/requirements.md`（Minimal）
   - 大規模チーム: `templates/requirements-full.md`（Full）

3. **requirements.md 生成**:
   - テンプレートに収集・整理した情報を記入
   - [NEEDS CLARIFICATION] マーカーで不明点を明示（最大3箇所）
   - Write tool でプロジェクトルートに保存

4. **ユーザーレビュー依頼**:
   - 生成した requirements.md の内容を提示
   - 不明点（[NEEDS CLARIFICATION]）があれば質問
   - 承認を得てから次ステップへ

**成果物**:
- `requirements.md`（プロジェクトルート）

## 成功基準の品質チェック

すべての成功基準は以下の3観点を満たす必要がある:

### 1. 測定可能性（Measurable）

主観的表現を排除し、数値・状態で表現:

| NG例 | OK例 |
|-----|-----|
| 「速い」 | 「実行時間5秒以内」 |
| 「使いやすい」 | 「3クリック以内で操作完了」 |
| 「安定している」 | 「エラー率1%以下」 |

### 2. 検証可能性（Verifiable）

テストや確認方法が明確:

| NG例 | OK例 |
|-----|-----|
| 「正しく動作する」 | 「unit test が全て通る」 |
| 「ドキュメントがある」 | 「README.md に使用例が3つ記載されている」 |
| 「保守しやすい」 | 「cyclomatic complexity が 10以下」 |

### 3. 具体性（Specific）

曖昧な表現を避け、具体的に記述:

| NG例 | OK例 |
|-----|-----|
| 「ファイルを処理する」 | 「CSV ファイルを読み込み、JSON に変換する」 |
| 「エラー処理を追加」 | 「ネットワークエラー時にリトライ（最大3回）」 |
| 「設定を改善」 | 「timeout 設定を30秒から60秒に変更」 |

**チェック手順**:
1. 各成功基準を読み上げる
2. 3観点（測定可能・検証可能・具体的）を1つずつチェック
3. 不合格項目があれば再定義
4. すべて合格するまで繰り返し

詳細は `~/.claude/skills/requirements/references/validation-checklist.md` 参照。

## 出力形式

**テンプレート選択**:
- Minimal: `~/.claude/skills/requirements/templates/requirements.md`（50行、5セクション）
- Full: `~/.claude/skills/requirements/templates/requirements-full.md`（120行、10セクション）

**必須セクション**（Minimal）:
1. 背景・目的
2. 成功基準
3. 優先順位（MoSCoW）
4. 制約条件
5. 次のステップ

**追加セクション**（Full）:
6. ステークホルダー
7. ユーザーストーリー
8. リスクと対策
9. 想定ユースケース
10. 参考資料

**記述ルール**:
- 各セクションは箇条書きで簡潔に
- 不明点は `[NEEDS CLARIFICATION]` で明示（最大3箇所）
- 推測で埋めない（「おそらく〜」は禁止）
- 成功基準は必ず測定可能な形式で記述

## 次のステップ

requirements.md 承認後、以下のいずれかに進む:

1. **architect スキルを起動**:
   - `requirements.md` を参照して技術設計（plan.md）を作成
   - コマンド例: `/architect`

2. **ユーザーが直接実装**:
   - `requirements.md` をもとに自分でコーディング
   - Claude Code は必要に応じて呼び出す

3. **requirements.md のみで完結**:
   - 要件定義だけが目的の場合（設計・実装は別チームが担当等）

**architect スキルとの連携**:
- architect は Phase 1 で `requirements.md` の存在を確認
- 存在する場合は背景・目的を引用（重複排除）
- 存在しない場合は独立して動作（後方互換性100%）